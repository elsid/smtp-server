digraph smtp_server {
	listening -> listening [label=RSET]; # ??
	listening -> wait_for_sender_address [label=EHLO];
	listening -> listening [label=NOOP];
	listening -> error [label=MAIL];
	listening -> error [label=RCPT];
	listening -> error [label=DATA];
	listening -> disconnected [label=QUIT];

	wait_for_sender_address -> listening [label=RSET];
	wait_for_sender_address -> wait_for_sender_address [label=EHLO];
	wait_for_sender_address -> wait_for_sender_address [label=NOOP];
	wait_for_sender_address -> wait_for_recipient_address [label=MAIL];
	wait_for_sender_address -> error [label=RCPT];
	wait_for_sender_address -> error [label=DATA];
	wait_for_sender_address -> disconnected [label=QUIT];

	wait_for_recipient_address -> listening [label=RSET];
	wait_for_recipient_address -> wait_for_sender_address [label=EHLO];
	wait_for_recipient_address -> wait_for_recipient_address [label=NOOP];
	wait_for_recipient_address -> error [label=MAIL];
	wait_for_recipient_address -> wait_for_recipient_address [label=RCPT];
	wait_for_recipient_address -> wait_for_recipient_address [label=DATA];
	wait_for_recipient_address -> wait_for_recipient_address [label=QUIT];

	receiving_data -> listening [label=RSET];
	receiving_data -> wait_for_sender_address [label=EHLO];
	receiving_data -> receiving_data [label=NOOP];
	receiving_data -> error [label=MAIL];
	receiving_data -> error [label=RCPT];
	receiving_data -> receiving_data [label=DATA];
	receiving_data -> disconnected [label=QUIT];

	disconnected
}